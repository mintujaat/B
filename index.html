<!DOCTYPE html>
<html lang="en">
<head><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KZHGLCLFBK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KZHGLCLFBK');
</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BMU TUFFANI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="https://static.wixstatic.com/media/37cafc_07faf3aa504e4033876eaefca1150457~mv2.png/v1/fit/w_2500,h_1330,al_c/37cafc_07faf3aa504e4033876eaefca1150457~mv2.png">
<STYle>/* ROOT COLORS & FONTS */
:root {
  --primary: #1a3e72;
  --primary-light: #4a78b6;
  --secondary: #6c8294;
  --bg: #f8f9fb;
  --bg-alt: #ffffff;
  --text-dark: #2c3e50;
  --text-muted: #7e8c99;
  --shadow: rgba(44, 62, 80, 0.1);
  --border-gray: #d7dbdf;
  font-family: 'Inter', sans-serif;
  font-size: 16px;
}

/* BASE RESET */
*, *::before, *::after {
  margin: 0; padding: 0; box-sizing: border-box;
}
body {
  background: var(--bg);
  color: var(--text-dark);
  font-family: var(--font-family);
  font-size: 1rem;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* LINK STYLES */
a {
  color: var(--primary);
  text-decoration: none;
  transition: color 0.3s ease;
  cursor: pointer;
}
a:hover, a:focus {
  color: var(--primary-light);
  text-decoration: underline;
}

/* HEADER */
header {
  background: var(--bg-alt);
  box-shadow: 0 0 12px var(--shadow);
  padding: 20px 8vw;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
  animation: headerFade 6s ease-in-out infinite alternate;
}
@keyframes headerFade {
  0% { box-shadow: 0 0 8px var(--shadow); }
  50% { box-shadow: 0 0 18px rgba(26, 62, 114, 0.3); }
  100% { box-shadow: 0 0 8px var(--shadow); }
}

header h1 {
  font-weight: 700;
  font-size: 1.6rem;
  color: var(--primary);
  cursor: default;
  letter-spacing: 2px;
}

#siteLogo {
  height: 40px;
  margin-right: 12px;
  border-radius: 5px;
  object-fit: contain;
  transition: transform 0.4s ease;
}
#siteLogo:hover {
  transform: scale(1.1) rotate(5deg);
}

/* NAVIGATION */
nav {
  display: flex;
  gap: 24px;
  align-items: center;
}

nav a {
  font-weight: 600;
  font-size: 1rem;
  padding: 7px 5px;
  border-bottom: 3px solid transparent;
  transition: border-color 0.35s ease, color 0.3s;
}
nav a:hover,
nav a:focus {
  border-bottom-color: var(--primary-light);
  color: var(--primary-light);
}

/* HAMBURGER MENU */
.hamburger {
  display: none;
  flex-direction: column;
  gap: 6px;
  cursor: pointer;
}
.hamburger div {
  width: 26px;
  height: 3px;
  background: var(--primary);
  border-radius: 3px;
  transition: all 0.3s ease;
}
.hamburger.active div:nth-child(1) {
  transform: translateY(9px) rotate(45deg);
}
.hamburger.active div:nth-child(2) {
  opacity: 0;
}
.hamburger.active div:nth-child(3) {
  transform: translateY(-9px) rotate(-45deg);
}

/* BANNERS */
.banner {
  background: var(--primary-light);
  color: white;
  font-weight: 600;
  font-size: 1rem;
  padding: 14px 12vw;
  margin: 18px 0;
  text-align: center;
  border-radius: 8px;
  animation: bannerPulse 8s ease-in-out infinite alternate;
  user-select: none;
}
@keyframes bannerPulse {
  0% { background-color: var(--primary-light); }
  50% { background-color: #3c7dc2; }
  100% { background-color: var(--primary-light); }
}

/* SEARCH BAR */
.search-bar {
  margin: 20px 12vw;
  display: flex;
  justify-content: center;
}

.search-bar input {
  width: 100%;
  max-width: 420px;
  padding: 12px 18px;
  border-radius: 28px;
  border: 1.9px solid var(--border-gray);
  font-size: 1rem;
  outline: none;
  transition: border-color 0.3s ease;
  color: var(--text-dark);
  background-color: var(--bg-alt);
  box-shadow: 0 3px 6px var(--shadow);
}

.search-bar input:focus {
  border-color: var(--primary);
  box-shadow: 0 0 16px var(--primary-light);
}

/* MAIN AND POSTS AREA */
main {
  padding: 0 12vw 40px 12vw;
  margin-top: 12px;
}

.section-title {
  font-size: 1.48rem;
  font-weight: 700;
  color: var(--primary);
  border-bottom: 3px solid var(--primary-light);
  margin-bottom: 18px;
  letter-spacing: 1.4px;
  animation: popUp 0.6s ease forwards;
}

@keyframes popUp {
  from { opacity: 0; transform: translateY(26px); }
  to { opacity: 1; transform: none; }
}

/* POSTS GRID */
#postsContainer {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
  gap: 22px;
  animation: fadeInUp 0.9s ease forwards;
}

@keyframes fadeInUp {
  0% { opacity: 0; transform: translateY(28px); }
  100% { opacity: 1; transform: translateY(0); }
}

/* CARDS */
.card {
  background: var(--bg-alt);
  border-radius: 14px;
  box-shadow: 0 8px 18px var(--shadow);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: box-shadow 0.25s ease, transform 0.28s ease;
}
.card:hover {
  box-shadow: 0 15px 38px rgba(26, 62, 114, 0.3);
  transform: translateY(-6px) scale(1.03);
}
.card img {
  width: 100%;
  height: 160px;
  object-fit: cover;
  transition: transform 0.3s ease;
  border-bottom: 3px solid var(--primary-light);
}
.card img:hover {
  transform: scale(1.07);
}
.card-content {
  padding: 18px;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
}
.card h3 {
  font-size: 1.25rem;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--primary);
}
.card p {
  flex-grow: 1;
  font-size: 1rem;
  color: var(--text-muted);
  margin-bottom: 12px;
}
.card small {
  font-size: 0.88rem;
  color: var(--secondary);
  margin-bottom: 8px;
}

/* BUTTONS */
.read-more {
  align-self: flex-start;
  background: var(--primary);
  color: #fff;
  padding: 10px 18px;
  border-radius: 28px;
  font-weight: 600;
  box-shadow: 0 5px 16px rgba(30, 80, 140, 0.35);
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
  user-select: none;
  font-size: 0.9rem;
  border: none;
}
.read-more:hover {
  background-color: var(--primary-light);
  transform: scale(1.08);
}

/* RATING */
.rating {
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
  user-select: none;
}
.rating .star {
  font-size: 1.22rem;
  color: #f1c40f;
  cursor: pointer;
  transition: color 0.2s ease;
}
.rating .star:hover {
  color: var(--primary);
}
.rating .avgRating {
  font-size: 0.9rem;
  color: var(--secondary);
}

/* FOOTER */
footer {
  background: var(--bg-alt);
  color: var(--secondary);
  padding: 22px 12vw;
  font-size: 0.9rem;
  border-top: 2px solid var(--border-gray);
  text-align: center;
  letter-spacing: 0.4px;
  margin-top: 40px;
}

/* RESPONSIVE */
@media (max-width: 930px) {
  main, footer, .banner, .search-bar {
    padding-left: 5vw; padding-right: 5vw;
  }
}
@media (max-width: 768px) {
  header {
    flex-wrap: wrap;
    padding: 14px 4vw;
  }
  nav {
    display: none;
    position: absolute;
    top: 58px;
    right: 1rem;
    background: var(--bg-alt);
    flex-direction: column;
    border-radius: 10px;
    box-shadow: 0 6px 24px rgba(26, 62, 114, 0.15);
    padding: 15px 10px;
    z-index: 110;
  }
  nav.show {
    display: flex;
  }
  .hamburger {
    display: flex;
  }
  #postsContainer {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
  }
  .card img {
    height: 130px;
  }
  .search-bar {
    margin: 20px 4vw;
  }
}
@media (max-width: 480px) {
  .card img {
    height: 110px;
  }
  .banner {
    font-size: 0.92rem;
    padding: 14px 4vw;
  }
}

/* FLOATING ALERT ICON */
#alertsIcon {
  position: fixed; bottom: 20px; right: 20px; background:#ff5aa5; color:#1a0f1a; border:none; border-radius:50%; width:60px; height:60px; font-size:1.5rem; cursor:pointer; box-shadow:0 4px 16px rgba(255,0,128,0.5); display:flex; align-items:center; justify-content:center; z-index:1000; transition:0.3s;
}
#alertsIcon:hover {background:#ff77b3;}
</STYle>
</head>
<body>

<header>
  <img id="siteLogo" src="https://via.placeholder.com/40/ff5aa5/1a0f1a?text=‚ù§Ô∏è" alt="Logo">
  <h1>BMU TUFANI ‚ù§Ô∏è</h1>
  <div class="hamburger" id="hamburger"><div></div><div></div><div></div></div>
  <nav id="navMenu">
    <a href="#">Home</a>
    <a href="about.html">About</a>
    <a href="privacy.html">Privacy Policy</a>
    <a href="contact.html">Contact</a>
    <a href="polls.html">poll</a>
  </nav>
</header>

<div class="banner">üíò Share your romantic stories, confessions & experiences!</div>
<div class="search-bar"><input type="text" id="searchInput" placeholder="Search posts..."></div>
<div class="banner"><marquee id="marqueeText" behavior="scroll" scrollamount="6">Welcome to BMU Dating - Find your love & share your stories!</marquee></div>

<main>
  <h2 class="section-title">Recommended Posts</h2>
  <div class="carousel" id="carouselContainer"></div>

  <h2 class="section-title">All Posts</h2>
  <div id="postsContainer"></div>
</main>

<!-- POPUP -->
<div id="popupBox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; z-index:9999;">
  <div id="popupContent" style="background:#ffccd5; color:#330022; padding:20px; border-radius:15px; max-width:400px; text-align:center; min-width:300px;">
    <img id="popupImageBox" src="" alt="Popup Image" style="max-width:100px; display:none; margin-bottom:10px; border-radius:50%;">
    <p id="popupMessage">Loading...</p>
    <button id="popupCloseBtn" disabled style="margin-top:15px; padding:8px 20px; background:#ff5aa5; border:none; border-radius:20px; cursor:not-allowed; opacity:0.5;">I AGREE ‚ù§Ô∏è</button>
  </div>
</div>

<!-- AUDIO -->
<audio id="welcomeAudio" src="welcome.mp3"></audio>

<footer>¬© <span id="year"></span> BMU TUFANI ‚ù§Ô∏è <br> Designed for hearts & stories</footer>

<!-- ALERTS FLOAT -->
<button id="alertsIcon">üîî</button>
<div id="alertsPopup"></div>

<!-- JS IMPORTS -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, orderBy, doc, getDoc, addDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

document.getElementById('year').innerText = new Date().getFullYear();

const firebaseConfig = {
  apiKey: "AIzaSyA7pGe0YS6HrscAjwjJefgr9tAKO__UZkU",
  authDomain: "blog-2f57c.firebaseapp.com",
  projectId: "blog-2f57c",
  storageBucket: "blog-2f57c.appspot.com",
  messagingSenderId: "608339540577",
  appId: "1:608339540577:web:cd5323ea45e3a4b4dc4820",
  measurementId: "G-JEPHSB73V3"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Hamburger toggle
document.getElementById('hamburger').addEventListener('click', () => document.getElementById('navMenu').classList.toggle('show'));

// LOAD SETTINGS
async function loadSiteSettings(){
  const settingsRef = doc(db,'settings','siteSettings');
  const snap = await getDoc(settingsRef);
  if(snap.exists()){
    const data = snap.data();
    if(data.logoURL) document.getElementById('siteLogo').src = data.logoURL;
    if(data.marqueeText) document.getElementById('marqueeText').innerText = data.marqueeText;
  }
}

// LOAD POSTS
const postsContainer = document.getElementById('postsContainer');
const carouselContainer = document.getElementById('carouselContainer');
const searchInput = document.getElementById('searchInput');
let allPosts = [];

async function loadPosts(){
  postsContainer.innerHTML=''; carouselContainer.innerHTML=''; allPosts=[];
  const postsSnapshot = await getDocs(query(collection(db, 'blogs'), orderBy('createdAt', 'desc')));
  postsSnapshot.forEach(docSnap=> allPosts.push({...docSnap.data(), id: docSnap.id}));
  renderPosts(allPosts); renderCarousel(allPosts); lazyLoadCards(); attachStarListeners();
}

// RENDER POSTS
function renderPosts(posts){
  postsContainer.innerHTML='';
  if(posts.length===0) postsContainer.innerHTML='<p style="grid-column:1/-1;text-align:center;">No posts found.</p>';
  posts.forEach(post=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <img src="${post.imageURL||'https://via.placeholder.com/400x180/ff77b3/1a0f1a?text=No+Image'}" alt="Post Image">
      <div class="card-content">
        <h3>${post.title}</h3>
        <p>${post.content.slice(0,100)}...</p>
        <small>By: ${post.authorName}</small>
        <a href="read.html?id=${post.id}" class="read-more">Read More</a>
        <div class="rating" data-post-id="${post.id}">
          ${[1,2,3,4,5].map(i=>`<span class="star" data-value="${i}">‚òÜ</span>`).join('')}
          <small class="avgRating">0/5</small>
        </div>
      </div>
    `;
    postsContainer.appendChild(card);
  });
}

// CAROUSEL
function renderCarousel(posts){
  carouselContainer.innerHTML='';
  const recommended = posts.filter(p=>p.recommended);
  if(recommended.length===0){ carouselContainer.style.display='none'; return; }
  carouselContainer.style.display='flex';
  recommended.forEach(post=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML=`
      <img src="${post.imageURL||'https://via.placeholder.com/400x180/ff77b3/1a0f1a?text=No+Image'}" alt="Post Image">
      <div class="card-content">
        <h3>${post.title}</h3>
        <p>${post.content.slice(0,80)}...</p>
        <a href="read.html?id=${post.id}" class="read-more">Read More</a>
      </div>
    `;
    carouselContainer.appendChild(card);
  });
}

// LAZY LOAD
function lazyLoadCards(){
  document.querySelectorAll('.card').forEach(card=>{
    const observer = new IntersectionObserver(entries=>{
      entries.forEach(entry=>{ if(entry.isIntersecting){ entry.target.classList.add('visible'); observer.unobserve(entry.target); } });
    },{threshold:0.1});
    observer.observe(card);
  });
}

// SEARCH
searchInput.addEventListener('input', ()=>{
  const term = searchInput.value.toLowerCase();
  const filtered = allPosts.filter(p=>p.title.toLowerCase().includes(term)||p.content.toLowerCase().includes(term));
  renderPosts(filtered); lazyLoadCards(); attachStarListeners();
  if(term.length>0) carouselContainer.style.display='none'; else renderCarousel(allPosts);
});

// RATINGS
async function loadRatings(postId, container){
  const snap = await getDocs(collection(db,"blogs",postId,"ratings"));
  let total=0; snap.forEach(d=> total+=d.data().stars);
  const avg = snap.size>0?(total/snap.size).toFixed(1):0;
  container.querySelector(".avgRating").innerText=`${avg}/5`;
}
function attachStarListeners(){
  document.querySelectorAll('.rating').forEach(ratingEl=>{
    const postId = ratingEl.dataset.postId;
    const stars = ratingEl.querySelectorAll('.star');
    stars.forEach(star=>{
      star.addEventListener('mouseover',()=>{ const val=star.dataset.value; stars.forEach((s,i)=>s.innerText=i<val?'‚òÖ':'‚òÜ'); });
      star.addEventListener('mouseleave',()=>loadRatings(postId,ratingEl));
      star.addEventListener('click', async ()=>{
        await addDoc(collection(db,"blogs",postId,"ratings"),{stars:parseInt(star.dataset.value),ratedAt:new Date()});
        loadRatings(postId,ratingEl);
      });
    });
    loadRatings(postId,ratingEl);
  });
}

// POPUP + AUDIO
async function showPopup(){
  const popupRef = doc(db, "settings", "popupMessage");
  const snap = await getDoc(popupRef);
  if(snap.exists()){
    const data = snap.data();
    if(data.text) document.getElementById("popupMessage").innerText = data.text;
    if(data.image){ const img=document.getElementById("popupImageBox"); img.src=data.image; img.style.display="block"; }
    const box=document.getElementById("popupBox"); box.style.display="flex";
    const btn=document.getElementById("popupCloseBtn"); 
    btn.disabled=false; 
    btn.style.cursor="pointer"; 
    btn.style.opacity="1";
    btn.onclick = () => {
      box.style.display="none";
      const audio = document.getElementById("welcomeAudio");
      audio.play().catch(err => console.log("Audio play failed:", err));
    };
  }
}
showPopup();

// ALERTS
const icon=document.getElementById("alertsIcon");
const popup=document.getElementById("alertsPopup");
icon.addEventListener("click",()=>{ popup.style.display=popup.style.display==="flex"?"none":"flex"; });

async function loadAlerts(){
  popup.innerHTML='';
  const snap = await getDocs(query(collection(db,"alerts"), orderBy("createdAt","desc")));
  if(snap.empty){ popup.innerHTML='<p style="text-align:center;color:#ffb3d9;">No alerts</p>'; return; }
  snap.forEach(docSnap=>{
    const data=docSnap.data();
    const div=document.createElement("div"); div.className="alert";
    div.innerHTML=`<h3>${data.title}</h3><p>${data.message}</p>`;
    popup.appendChild(div);
  });
}

loadSiteSettings(); loadPosts(); loadAlerts();
</script>

<script>
document.addEventListener('contextmenu', e => e.preventDefault());
document.onkeydown = function(e) {
  if (e.key == "F12" || (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key)) || (e.ctrlKey && e.key == 'U')) {
    return false;
  }
};
</script>

<!-- Floating Games Button -->
<a href="game.html" id="gamesBtn" style="
    position: fixed;
    left: 20px;  
    bottom: 50px;
    background:#38bdf8;
    color:#fff;
    padding:15px 18px;
    border-radius:50px;
    font-weight:bold;
    cursor:pointer;
    box-shadow:0 4px 15px rgba(0,0,0,0.3);
    z-index:9999;
    text-decoration:none;
"> Lovely Games‚ù§Ô∏è</a>
<style>#gamesBtn:hover { transform: scale(1.1); background:#0ea5e9; }</style>
<!-- Floating Chatroom Button -->
<a href="chatroom.html" id="chatBtn" style="
    position: fixed;
    left: 20px;  
    bottom: 100px;   /* üîº ‡§á‡§∏‡§ï‡•ã ‡§ä‡§™‡§∞ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ */
    background:#38bdf8;
    color:#fff;
    padding:15px 18px;
    border-radius:50px;
    font-weight:bold;
    cursor:pointer;
    box-shadow:0 4px 15px rgba(0,0,0,0.3);
    z-index:9999;
    text-decoration:none;
"> Chatroom üó®</a>


<style>
#chatBtn:hover { transform: scale(1.1); background:#0ea5e9; }
#gamesBtn:hover { transform: scale(1.1); background:#e11d48; }
</style>

</body>
</html>
